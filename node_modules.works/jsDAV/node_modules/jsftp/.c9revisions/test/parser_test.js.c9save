{"ts":1353668033610,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/*\n * @package jsftp\n * @copyright Copyright(c) 2011 Ajax.org B.V. <info AT ajax DOT org>\n * @author Sergi Mansilla <sergi.mansilla@gmail.com>\n * @license https://github.com/sergi/jsFTP/blob/master/LICENSE MIT License\n */\n\n\"use strict\";\n\nvar assert = require(\"assert\");\nvar libpath = process.env['VFS_FTP_COV'] ? '../lib-cov' : '../lib';\nvar Parser = require(libpath + '/ftpParser');\n\ndescribe(\"jsftp file listing parser\", function() {\n    it(\"test ftp unix LIST responses\", function() {\n        var str = \"211-Status of /:\\r\\n\\\n drwx--x---  10 mrclash  adm          4096 Aug  9 14:48 .\\r\\n\\\n drwx--x---  10 mrclash  adm          4096 Aug  9 14:48 ..\\r\\n\\\n -rw-r--r--   1 mrclash  pg223090      260 Mar 25  2008 .alias\\r\\n\\\n -rw-------   1 mrclash  pg223090     2219 Sep  5  2010 .bash_history\\r\\n\\\n -rw-r--r--   1 mrclash  pg223090       55 Mar 25  2008 .bashrc\\r\\n\\\n drwx------   2 mrclash  pg223090     4096 Aug  9 14:39 .ssh\\r\\n\\\n -rw-r--r--   1 mrclash  pg223090       18 Aug  8 13:06 Cloud9 FTP connection test.\\r\\n\\\n -rwxr-xr-x   1 mrclash  pg223090 68491314 Jan 22  2009 Documents.zip\\r\\n\\\n -rwxr-xr-x   1 mrclash  pg223090      141 Nov  1  2008 EcPxMptYISIdOSjS.XFV.Q--.html\\r\\n\\\n dr-xr-x---   7 mrclash  dhapache     4096 May 29 07:47 logs\\r\\n\\\n drwxr-xr-x   7 mrclash  pg223090     4096 Aug  9 14:48 re-alpine.git\\r\\n\\\n -rwxr-xr-x   1 mrclash  pg223090   312115 Jan 22  2009 restaurants.csv\\r\\n\\\n drwxr-xr-x  12 mrclash  pg223090     4096 Jul 24 02:42 sergimansilla.com\\r\\n\\\n drwxr-xr-x  10 mrclash  pg223090     4096 Aug  3  2009 svn\\r\\n\\\n -rwxr-xr-x   1 mrclash  pg223090       76 Aug  9 14:47 sync-alpine.sh\\r\\n\\\n drwxr-xr-x   2 mrclash  pg223090     4096 Aug  4 10:00 test_c9\\r\\n\\\n -rw-r--r--   1 mrclash  pg223090        4 Aug  4 09:11 testfile.txt\\r\\n\\\n lrwxr-xr-x    1 sergi  staff      11 Jul  7  2011 .vimrc -> .vim/.vimrc\\r\\n\n211 End of status\";\n\n        var unixEntries = [\n            {\n                //line: \"-rw-r--r--   1 mrclash  pg223090      260 Mar 25  2008 .alias\",\n                type: 0,\n                size: 260,\n                name: \".alias\",\n                time: +new Date(\"Mar 25  2008\"),\n                owner: \"mrclash\",\n                group: \"pg223090\",\n\n                userReadPerm  : true,\n                userWritePerm : true,\n                userExecPerm  : false,\n\n                groupReadPerm  : true,\n                groupWritePerm : false,\n                groupExecPerm  : false,\n\n                otherReadPerm  : true,\n                otherWritePerm : false,\n                otherExecPerm  : false\n            },\n            {\n                //line: \"-rw-------   1 mrclash  pg223090     2219 Sep  5  2010 .bash_history\",\n                type: 0,\n                size: 2219,\n                name: \".bash_history\",\n                time: +new Date(\"Sep  5  2010\"),\n                owner: \"mrclash\",\n                group: \"pg223090\",\n\n                userReadPerm  : true,\n                userWritePerm : true,\n                userExecPerm  : false,\n\n                groupReadPerm  : false,\n                groupWritePerm : false,\n                groupExecPerm  : false,\n\n                otherReadPerm  : false,\n                otherWritePerm : false,\n                otherExecPerm  : false\n            },\n            {\n                type: 0,\n                size: 55,\n                name: \".bashrc\",\n                time: +new Date(\"Mar 25  2008\"),\n                owner: \"mrclash\",\n                group: \"pg223090\",\n\n                userReadPerm  : true,\n                userWritePerm : true,\n                userExecPerm  : false,\n\n                groupReadPerm  : true,\n                groupWritePerm : false,\n                groupExecPerm  : false,\n\n                otherReadPerm  : true,\n                otherWritePerm : false,\n                otherExecPerm  : false\n            },\n            {\n                type: 1,\n                size: 4096,\n                name: \".ssh\",\n                time: +new Date(\"Aug  9 14:39 \" + new Date().getFullYear()),\n                owner: \"mrclash\",\n                group: \"pg223090\",\n\n                userReadPerm  : true,\n                userWritePerm : true,\n                userExecPerm  : true,\n\n                groupReadPerm  : false,\n                groupWritePerm : false,\n                groupExecPerm  : false,\n\n                otherReadPerm  : false,\n                otherWritePerm : false,\n                otherExecPerm  : false\n            },\n            {\n                type: 0,\n                size: 18,\n                name: \"Cloud9 FTP connection test.\",\n                time: +new Date(\"Aug  8 13:06 \" + new Date().getFullYear()),\n                owner: \"mrclash\",\n                group: \"pg223090\",\n\n                userReadPerm  : true,\n                userWritePerm : true,\n                userExecPerm  : false,\n\n                groupReadPerm  : true,\n                groupWritePerm : false,\n                groupExecPerm  : false,\n\n                otherReadPerm  : true,\n                otherWritePerm : false,\n                otherExecPerm  : false\n            },\n            {\n                type: 0,\n                size: 68491314,\n                name: \"Documents.zip\",\n                time: +new Date(\"Jan 22  2009\"),\n                owner: \"mrclash\",\n                group: \"pg223090\",\n\n                userReadPerm  : true,\n                userWritePerm : true,\n                userExecPerm  : true,\n\n                groupReadPerm  : true,\n                groupWritePerm : false,\n                groupExecPerm  : true,\n\n                otherReadPerm  : true,\n                otherWritePerm : false,\n                otherExecPerm  : true\n            },\n            {\n                type: 0,\n                size: 141,\n                name: \"EcPxMptYISIdOSjS.XFV.Q--.html\",\n                time: +new Date(\"Nov  1  2008\"),\n                owner: \"mrclash\",\n                group: \"pg223090\",\n\n                userReadPerm  : true,\n                userWritePerm : true,\n                userExecPerm  : true,\n\n                groupReadPerm  : true,\n                groupWritePerm : false,\n                groupExecPerm  : true,\n\n                otherReadPerm  : true,\n                otherWritePerm : false,\n                otherExecPerm  : true\n            },\n            {\n                type: 1,\n                size: 4096,\n                name: \"logs\",\n                time: +new Date(\"May 29 07:47 \" + new Date().getFullYear()),\n                owner: \"mrclash\",\n                group: \"dhapache\",\n\n                userReadPerm  : true,\n                userWritePerm : false,\n                userExecPerm  : true,\n\n                groupReadPerm  : true,\n                groupWritePerm : false,\n                groupExecPerm  : true,\n\n                otherReadPerm  : false,\n                otherWritePerm : false,\n                otherExecPerm  : false\n            },\n            {\n                type: 1,\n                size: 4096,\n                name: \"re-alpine.git\",\n                time: +new Date(\"Aug  9 14:48 \" + new Date().getFullYear()),\n                owner: \"mrclash\",\n                group: \"pg223090\",\n\n                userReadPerm  : true,\n                userWritePerm : true,\n                userExecPerm  : true,\n\n                groupReadPerm  : true,\n                groupWritePerm : false,\n                groupExecPerm  : true,\n\n                otherReadPerm  : true,\n                otherWritePerm : false,\n                otherExecPerm  : true\n            },\n            {\n                type: 0,\n                size: 312115,\n                time: +new Date(\"Jan 22  2009\"),\n                name: \"restaurants.csv\",\n                owner: \"mrclash\",\n                group: \"pg223090\",\n\n                userReadPerm  : true,\n                userWritePerm : true,\n                userExecPerm  : true,\n\n                groupReadPerm  : true,\n                groupWritePerm : false,\n                groupExecPerm  : true,\n\n                otherReadPerm  : true,\n                otherWritePerm : false,\n                otherExecPerm  : true\n            },\n            {\n                type: 1,\n                size: 4096,\n                time: +new Date(\"Jul 24 02:42 \" + new Date().getFullYear()),\n                name: \"sergimansilla.com\",\n                owner: \"mrclash\",\n                group: \"pg223090\",\n\n                userReadPerm  : true,\n                userWritePerm : true,\n                userExecPerm  : true,\n\n                groupReadPerm  : true,\n                groupWritePerm : false,\n                groupExecPerm  : true,\n\n                otherReadPerm  : true,\n                otherWritePerm : false,\n                otherExecPerm  : true\n            },\n            {\n                type: 1,\n                size: 4096,\n                time: +new Date(\"Aug  3  2009\"),\n                name: \"svn\",\n                owner: \"mrclash\",\n                group: \"pg223090\",\n\n                userReadPerm  : true,\n                userWritePerm : true,\n                userExecPerm  : true,\n\n                groupReadPerm  : true,\n                groupWritePerm : false,\n                groupExecPerm  : true,\n\n                otherReadPerm  : true,\n                otherWritePerm : false,\n                otherExecPerm  : true\n            },\n            {\n                type: 0,\n                size: 76,\n                time: +new Date(\"Aug  9 14:47 \" + new Date().getFullYear()),\n                name: \"sync-alpine.sh\",\n                owner: \"mrclash\",\n                group: \"pg223090\",\n\n                userReadPerm  : true,\n                userWritePerm : true,\n                userExecPerm  : true,\n\n                groupReadPerm  : true,\n                groupWritePerm : false,\n                groupExecPerm  : true,\n\n                otherReadPerm  : true,\n                otherWritePerm : false,\n                otherExecPerm  : true\n            },\n            {\n                type: 1,\n                size: 4096,\n                time: +new Date(\"Aug  4 10:00 \" + new Date().getFullYear()),\n                name: \"test_c9\",\n                owner: \"mrclash\",\n                group: \"pg223090\",\n\n                userReadPerm  : true,\n                userWritePerm : true,\n                userExecPerm  : true,\n\n                groupReadPerm  : true,\n                groupWritePerm : false,\n                groupExecPerm  : true,\n\n                otherReadPerm  : true,\n                otherWritePerm : false,\n                otherExecPerm  : true\n            },\n            {\n                type: 0,\n                size: 4,\n                time: +new Date(\"Aug  4 09:11 \" + new Date().getFullYear()),\n                name: \"testfile.txt\",\n                owner: \"mrclash\",\n                group: \"pg223090\",\n\n                userReadPerm  : true,\n                userWritePerm : true,\n                userExecPerm  : false,\n\n                groupReadPerm  : true,\n                groupWritePerm : false,\n                groupExecPerm  : false,\n\n                otherReadPerm  : true,\n                otherWritePerm : false,\n                otherExecPerm  : false\n            },\n            {\n                type: 0,\n                size: 4,\n                time: +new Date(\"Jul  7  2011\"),\n                name: \".vimrc\",\n                target: \".vim/.vimrc\",\n                owner: \"sergi\",\n                group: \"staff\",\n\n                userReadPerm  : true,\n                userWritePerm : true,\n                userExecPerm  : true,\n\n                groupReadPerm  : true,\n                groupWritePerm : false,\n                groupExecPerm  : true,\n\n                otherReadPerm  : true,\n                otherWritePerm : false,\n                otherExecPerm  : true\n            }\n        ];\n\n        var str2 = \"211-Status of /www/userName/test:\\\n211-drwxr-x---   2 userName alternc      4096 Aug 22 03:45 .\\r\\n\\\n211-drwxr-x---   5 userName alternc      4096 Aug 22 03:45 ..\\r\\n\\\n211--rw-r-----   1 userName alternc       460 Aug 22 03:45 test1\\r\\n\\\n211--rw-r-----   1 userName alternc       560 Aug 22 03:47 test2\\r\\n\\\n211 End of status\";\n\n         var unixEntries2 = [\n             {\n                //line: \"-rw-r--r--   1 mrclash  pg223090      260 Mar 25  2008 .alias\",\n                type: 0,\n                size: 460,\n                name: \"test1\",\n                time: +new Date(\"Aug 22 03:45 \" + new Date().getFullYear()),\n                owner: \"userName\",\n                group: \"alternc\",\n\n                userReadPerm  : true,\n                userWritePerm : true,\n                userExecPerm  : false,\n\n                groupReadPerm  : true,\n                groupWritePerm : false,\n                groupExecPerm  : false,\n\n                otherReadPerm  : false,\n                otherWritePerm : false,\n                otherExecPerm  : false\n            },\n            {\n                //line: \"-rw-r--r--   1 mrclash  pg223090      260 Mar 25  2008 .alias\",\n                type: 0,\n                size: 560,\n                name: \"test2\",\n                time: +new Date(\"Aug 22 03:47 \" + new Date().getFullYear()),\n                owner: \"userName\",\n                group: \"alternc\",\n\n                userReadPerm  : true,\n                userWritePerm : true,\n                userExecPerm  : false,\n\n                groupReadPerm  : true,\n                groupWritePerm : false,\n                groupExecPerm  : false,\n\n                otherReadPerm  : false,\n                otherWritePerm : false,\n                otherExecPerm  : false\n            }\n        ]\n\n        str\n            .split(/\\r\\n/)\n            .map(function(entry) {\n                return Parser.entryParser(entry.replace(\"\\n\", \"\"));\n            })\n            // Flatten the array\n            .filter(function(value){ return !!value; })\n            .forEach(function(entry, i) {\n                assert.equal(unixEntries[i].type, entry.type);\n                assert.equal(unixEntries[i].size, entry.size);\n                assert.equal(unixEntries[i].name, entry.name);\n                assert.equal(unixEntries[i].time, entry.time);\n                assert.equal(unixEntries[i].owner, entry.owner);\n                assert.equal(unixEntries[i].group, entry.group);\n\n                assert.equal(unixEntries[i].userReadPerm,   entry.userPermissions.read);\n                assert.equal(unixEntries[i].userWritePerm,  entry.userPermissions.write);\n                assert.equal(unixEntries[i].userExecPerm,   entry.userPermissions.exec);\n\n                assert.equal(unixEntries[i].groupReadPerm,  entry.groupPermissions.read);\n                assert.equal(unixEntries[i].groupWritePerm, entry.groupPermissions.write);\n                assert.equal(unixEntries[i].groupExecPerm,  entry.groupPermissions.exec);\n\n                assert.equal(unixEntries[i].otherReadPerm,  entry.otherPermissions.read);\n                assert.equal(unixEntries[i].otherWritePerm, entry.otherPermissions.write);\n                assert.equal(unixEntries[i].otherExecPerm,  entry.otherPermissions.exec);\n            });\n\n        str2\n            .split(/\\r\\n/)\n            .map(function(entry) {\n                return Parser.entryParser(entry.replace(\"\\n\", \"\"));\n            })\n            // Flatten the array\n            .filter(function(value){ return !!value; })\n            .forEach(function(entry, i) {\n                assert.equal(unixEntries2[i].type, entry.type);\n                assert.equal(unixEntries2[i].size, entry.size);\n                assert.equal(unixEntries2[i].name, entry.name);\n                assert.equal(unixEntries2[i].time, entry.time);\n                assert.equal(unixEntries2[i].owner, entry.owner);\n                assert.equal(unixEntries2[i].group, entry.group);\n\n                assert.equal(unixEntries2[i].userReadPerm,   entry.userPermissions.read);\n                assert.equal(unixEntries2[i].userWritePerm,  entry.userPermissions.write);\n                assert.equal(unixEntries2[i].userExecPerm,   entry.userPermissions.exec);\n\n                assert.equal(unixEntries2[i].groupReadPerm,  entry.groupPermissions.read);\n                assert.equal(unixEntries2[i].groupWritePerm, entry.groupPermissions.write);\n                assert.equal(unixEntries2[i].groupExecPerm,  entry.groupPermissions.exec);\n\n                assert.equal(unixEntries2[i].otherReadPerm,  entry.otherPermissions.read);\n                assert.equal(unixEntries2[i].otherWritePerm, entry.otherPermissions.write);\n                assert.equal(unixEntries2[i].otherExecPerm,  entry.otherPermissions.exec);\n            });\n    });\n\n    it(\"test ftp windows/DOS LIST responses\" , function() {\n        var dosEntries = [\n            {\n                line: '04-27-00  09:09PM       <DIR>          licensed',\n                type: 1,\n                size: 0,\n                time: +(new Date(\"04-27-00  09:09 PM\")),\n                name: 'licensed',\n            },\n            {\n                line: '11-18-03  10:16AM       <DIR>          pub',\n                type: 1,\n                size: 0,\n                time: +(new Date(\"11-18-03  10:16 AM\")),\n                name: 'pub',\n            },\n            {\n                line: '04-14-99  03:47PM                  589 readme.htm',\n                type: 0,\n                size: 589,\n                time: +(new Date(\"04-14-99  03:47 PM\")),\n                name: 'readme.htm'\n            }\n        ];\n\n        dosEntries.forEach(function(entry) {\n            var result = Parser.entryParser(entry.line);\n\n            assert.equal(result.type, entry.type);\n            assert.equal(result.size, entry.size);\n            assert.equal(result.name, entry.name);\n            assert.equal(result.time, entry.time);\n        });\n    });\n\n    /*\n     * We are not supporting MLSx commands yet\n     *\n     * http://rfc-ref.org/RFC-TEXTS/3659/chapter7.html\n     * http://www.rhinosoft.com/newsletter/NewsL2005-07-06.asp?prod=rs\n     *\n    \"test parse MLSD command lines\" : function(next) {\n        var lines = [\n            {\n                line: \"Type=file;Size=17709913;Modify=20050502182143; Choices.mp3\",\n                Type: \"file\",\n                Size: \"17709913\",\n                Modify: \"20050502182143\",\n                name: \"Choices.mp3\"\n            },\n            {\n                line: \"Type=cdir;Perm=el;Unique=keVO1+ZF4; test\",\n                type: \"file\",\n                perm: \"el\",\n\n            },\n            {\n                line: \"Type=pdir;Perm=e;Unique=keVO1+d?3; ..\"\n            }\n        ];\n\n\n\n\n        //\"Type=cdir;Perm=el;Unique=keVO1+ZF4; test\",\n        //\"Type=pdir;Perm=e;Unique=keVO1+d?3; ..\",\n        //\"Type=OS.unix=slink:/foobar;Perm=;Unique=keVO1+4G4; foobar\",\n        //\"Type=OS.unix=chr-13/29;Perm=;Unique=keVO1+5G4; device\",\n        //\"Type=OS.unix=blk-11/108;Perm=;Unique=keVO1+6G4; block\",\n        //\"Type=file;Perm=awr;Unique=keVO1+8G4; writable\",\n        //\"Type=dir;Perm=cpmel;Unique=keVO1+7G4; promiscuous\",\n        //\"Type=dir;Perm=;Unique=keVO1+1t2; no-exec\",\n        //\"Type=file;Perm=r;Unique=keVO1+EG4; two words\",\n        //\"Type=file;Perm=r;Unique=keVO1+IH4;  leading space\",\n        //\"Type=file;Perm=r;Unique=keVO1+1G4; file1\",\n        //\"Type=dir;Perm=cpmel;Unique=keVO1+7G4; incoming\",\n        //\"Type=file;Perm=r;Unique=keVO1+1G4; file2\",\n        //\"Type=file;Perm=r;Unique=keVO1+1G4; file3\",\n        //\"Type=file;Perm=r;Unique=keVO1+1G4; file4\",\n\n        var parsed = Parser.parseMList(line);\n\n        assert.equal(\"file\", parsed.Type);\n        assert.equal(\"17709913\", parsed.Size);\n        assert.equal(\"20050502182143\", parsed.Modify);\n        assert.equal(\"Choices.mp3\", parsed.name);\n        next();\n    }\n    */\n})\n\n"]],"start1":0,"start2":0,"length1":0,"length2":19718}]],"length":19718}
{"contributors":[],"silentsave":false,"ts":1353668041299,"patch":[[{"diffs":[[0,"imrc\\r\\n"],[1,"\\"],[0,"\n211 End"]],"start1":1838,"start2":1838,"length1":16,"length2":17}]],"length":19719,"saved":false}
{"ts":1353668103474,"patch":[[{"diffs":[[0,"       ]"],[1,";"],[0,"\n\n      "]],"start1":13591,"start2":13591,"length1":16,"length2":17}]],"length":19720,"saved":false}
{"ts":1353668113926,"patch":[[{"diffs":[[0,"          type: "],[-1,"0"],[1,"2"],[0,",\n              "]],"start1":11199,"start2":11199,"length1":33,"length2":33}]],"length":19720,"saved":false}
{"ts":1353668143289,"patch":[[{"diffs":[[0,"          size: "],[-1,"4"],[1,"11"],[0,",\n              "]],"start1":11224,"start2":11224,"length1":33,"length2":34}]],"length":19721,"saved":false}
